<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mission Anniversaire üéÇ</title>

  <style>
    :root{
      --bg1:#0b1020;
      --bg2:#121a33;
      --card:#0f1730cc;
      --txt:#eaf0ff;
      --muted:#a9b4d6;
      --accent:#ff4b7d;
      --accent2:#7cf7d4;
      --danger:#ff5b5b;
      --ok:#31f28b;
      --border:rgba(255,255,255,.12);
      --shadow: 0 18px 60px rgba(0,0,0,.45);
      --radius: 22px;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      min-height:100vh;
      color:var(--txt);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:
        radial-gradient(900px 600px at 20% 20%, #2b2bff22, transparent 55%),
        radial-gradient(800px 520px at 80% 30%, #ff2b7a22, transparent 55%),
        radial-gradient(900px 680px at 50% 90%, #35ffd322, transparent 55%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
      overflow-x:hidden;
    }

    .wrap{
      width:min(940px, 100%);
      display:grid;
      gap:16px;
      position:relative;
      z-index:2;
    }

    .topbar{
      display:flex;
      gap:12px;
      align-items:stretch;
      justify-content:space-between;
      flex-wrap:wrap;
    }

    .pill{
      background: rgba(15, 23, 48, .55);
      border:1px solid var(--border);
      border-radius: 999px;
      padding:10px 14px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      display:flex;
      gap:10px;
      align-items:center;
      white-space:nowrap;
    }

    .pill b{ letter-spacing:.3px; }
    .pill .dot{
      width:10px; height:10px; border-radius:50%;
      background: var(--accent2);
      box-shadow: 0 0 18px rgba(124,247,212,.8);
    }

    .score{
      font-variant-numeric: tabular-nums;
      display:flex;
      align-items:center;
      gap:10px;
    }

    .score .badge{
      padding:6px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.08);
      border:1px solid var(--border);
    }

    .card{
      background: var(--card);
      border:1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
      overflow:hidden;
      position:relative;
    }

    .header{
      padding:22px 22px 14px;
      border-bottom: 1px solid var(--border);
    }

    .title{
      display:flex;
      align-items:center;
      gap:10px;
      font-size: 22px;
      margin:0;
    }

    .subtitle{
      margin:8px 0 0;
      color:var(--muted);
      line-height:1.45;
    }

    .content{
      padding:18px 22px 22px;
      display:grid;
      gap:14px;
    }

    .qmeta{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
      color:var(--muted);
      font-size:14px;
    }

    .progress{
      flex:1;
      min-width:220px;
      height:10px;
      border-radius: 999px;
      background: rgba(255,255,255,.08);
      border:1px solid var(--border);
      overflow:hidden;
    }
    .bar{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      border-radius: 999px;
      transition: width .35s ease;
    }

    .question{
      font-size: 20px;
      line-height:1.3;
      margin:6px 0 8px;
    }

    .options{
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap:12px;
    }

    @media (max-width:640px){
      .options{ grid-template-columns: 1fr; }
    }

    .opt{
      background: rgba(255,255,255,.06);
      border:1px solid var(--border);
      border-radius: 16px;
      padding:14px 14px;
      cursor:pointer;
      transition: transform .06s ease, background .2s ease, border-color .2s ease;
      user-select:none;
      display:flex;
      gap:10px;
      align-items:flex-start;
    }
    .opt:hover{
      background: rgba(255,255,255,.09);
      border-color: rgba(255,255,255,.2);
      transform: translateY(-1px);
    }
    .opt.selected{
      outline: 2px solid rgba(255,75,125,.55);
      background: rgba(255,75,125,.12);
    }
    .opt .radio{
      width:18px; height:18px; border-radius:50%;
      border:2px solid rgba(255,255,255,.35);
      margin-top:1px;
      flex:0 0 auto;
      display:grid;
      place-items:center;
    }
    .opt.selected .radio{
      border-color: rgba(255,75,125,.9);
    }
    .opt.selected .radio::after{
      content:"";
      width:9px; height:9px; border-radius:50%;
      background: rgba(255,75,125,.95);
      box-shadow: 0 0 12px rgba(255,75,125,.75);
    }

    .actions{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      align-items:center;
      margin-top:6px;
    }

    button{
      border:none;
      border-radius: 999px;
      padding:12px 18px;
      font-size: 15px;
      cursor:pointer;
      transition: transform .06s ease, opacity .2s ease;
      color:var(--txt);
    }
    button:active{ transform: translateY(1px); }

    .btn-primary{
      background: linear-gradient(90deg, var(--accent), #ff8aa6);
    }
    .btn-secondary{
      background: rgba(255,255,255,.09);
      border:1px solid var(--border);
    }

    button[disabled]{
      opacity:.55;
      cursor:not-allowed;
    }

    .msg{
      padding:12px 14px;
      border-radius: 14px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.06);
      color:var(--muted);
      display:none;
      line-height:1.35;
    }
    .msg.error{
      border-color: rgba(255,91,91,.35);
      background: rgba(255,91,91,.10);
      color: #ffd3d3;
    }
    .msg.ok{
      border-color: rgba(49,242,139,.35);
      background: rgba(49,242,139,.10);
      color: #d5ffe9;
    }

    .final{
      display:none;
      padding:22px;
      text-align:center;
    }
    .final h2{
      margin:0 0 10px;
      font-size:26px;
    }
    .final p{
      margin:0;
      color:var(--muted);
      line-height:1.5;
      font-size:16px;
    }

    .spark{
      display:inline-block;
      animation: pop .9s ease-in-out infinite alternate;
    }
    @keyframes pop{ from{ transform:translateY(0)} to{ transform:translateY(-3px)} }

    /* ====== WOW: Overlay "Mission accepted" ====== */
    .overlay{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.65);
      display:grid;
      place-items:center;
      z-index:50;
      backdrop-filter: blur(6px);
    }
    .overlay-card{
      width:min(780px, calc(100% - 28px));
      border-radius: 26px;
      border:1px solid var(--border);
      background: rgba(15,23,48,.82);
      box-shadow: var(--shadow);
      padding:24px;
      text-align:center;
    }
    .overlay-card h1{
      margin:0 0 10px;
      font-size:28px;
    }
    .overlay-card p{
      margin:0 0 14px;
      color:var(--muted);
      line-height:1.55;
    }
    .kbd{
      display:inline-block;
      padding:6px 10px;
      border-radius: 12px;
      background: rgba(255,255,255,.08);
      border:1px solid var(--border);
      font-variant-numeric: tabular-nums;
    }

    /* ====== Confetti canvas ====== */
    #confetti{
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index:40;
    }
  </style>
</head>

<body>

<canvas id="confetti"></canvas>

<!-- Overlay start -->
<div class="overlay" id="startOverlay">
  <div class="overlay-card">
    <h1>üïµÔ∏è‚Äç‚ôÇÔ∏è MISSION ACCEPTED</h1>
    <p>
      Salam a si Mohamed Amine Elmaaroufi üòå<br>
      ghanbdaw asidi b <b>quiz dyal l3id ŸÖŸäŸÑÿßÿØ</b>‚Ä¶ tgol l7a9i9a oghiiiir l7a9i9a/<br>
      Ghadi tÿ¨ÿßŸàÿ®ÿå w <b>ma t9derch douwez sou2al</b> hta tjaweb ‚Äúshih‚Äù üòà
    </p>
    <p style="margin-top:10px;">
      Nebdaw 3ala barakati Laaaah
    </p>
    <button class="btn-primary" id="startBtn">üöÄ ÿ®ÿØÿß ÿßŸÑŸÖŸáŸÖÿ©</button>
    <div style="margin-top:10px;color:var(--muted);font-size:13px;">
      Mode: <span class="kbd">Birthday QUIZZ</span> | Score kaytla3 f lfo9
    </div>
  </div>
</div>

  <div class="wrap">
    <div class="topbar">
      <div class="pill">
        <span class="dot"></span>
        <b>Mission Anniversaire</b>
        <span style="color:var(--muted)">‚Äî niveau ‚Äúv√©rit√© alternative‚Äù</span>
      </div>

      <div class="pill score" aria-live="polite">
        <span>Score</span>
        <span class="badge" id="score">0</span>
        <span style="color:var(--muted)">/</span>
        <span class="badge" id="maxScore">0</span>
      </div>
    </div>

    <div class="card" id="quizCard">
      <div class="header">
        <h1 class="title">üéÇ Quiz d‚Äôanniversaire (hadchi rah s√©rieux bezzaaaf) <span class="spark">‚ú®</span></h1>
        <p class="subtitle">
          R√®gle du jeu : maghatqderch douz la question jaya <b>hta tjaweb shih</b> ma3endek madir hadi hya l9a3ida üòå
        </p>
      </div>

      <div class="content">
        <div class="qmeta">
          <div style="min-width:160px">
            Question <b id="qIndex">1</b>/<span id="qTotal">1</span>
          </div>
          <div class="progress" aria-hidden="true"><div class="bar" id="bar"></div></div>
        </div>

        <div class="question" id="questionText"></div>

        <div class="options" id="options"></div>

        <div class="msg" id="msg"></div>

        <div class="actions">
          <button class="btn-primary" id="validateBtn" disabled>Valider ‚úÖ</button>
          <button class="btn-secondary" id="nextBtn" style="display:none;">Suivant ‚ûú</button>
          <button class="btn-secondary" id="restartBtn" style="display:none;">Rejouer üîÅ</button>
        </div>
      </div>
    </div>

    <div class="card final" id="finalCard">
      <h2>üéâ Naaaaaaaaaaadi Mission accomplie !</h2>
      <p id="finalText"></p>
      <div style="margin-top:16px;">
        <button class="btn-primary" id="restartBtn2">3awed tl3eb üîÅ</button>
      </div>
    </div>
  </div>

<script>
  // ========= SETTINGS =========
  const HARD_MODE_RESTART_ON_WRONG = false;

  // ========= QUESTIONS (darija) =========
  const QUESTIONS = [
    {
      text: "Ch7al f3amrek ?",
      options: ["19", "25", "78", "120"],
      correct: "78",
      ok: "‚úÖ Exact! 78 3am‚Ä¶ w katbban sghir üòå‚ú®",
      nope: "‚ùå Ljawaaaab marfouuuuud‚Ä¶ 3awed jarrab üòå"
    },
    {
      text: "F achmen 3am tzaditi fih ?",
      options: ["2001", "1802", "1999", "3026"],
      correct: "1802",
      ok: "‚úÖ Ayeeeh 1802‚Ä¶ nta mn zaman Napoleon üòåüòÇ",
      nope: "‚ùå Non non‚Ä¶ l'administration galat: 1802 üòå"
    },
    {
      text: "Achno huwa super-pouvoir dyalk ?",
      options: ["Katn3s 12 sa3a", "Katakol b7al l7alouf", "Katdir t√©l√©portation", "Zwin o bzaf"],
      correct: "Zwin o bzaf",
      ok: "‚úÖ Hadi obvious‚Ä¶ ghabghit nsowelk osafi üòåüî•",
      nope: "‚ùå Ma tkounsh modest bzaf‚Ä¶ jereb emrra khra üòè"
    },
    {
      text: "Achno smit lmalik dyal lmaghrib ?",
      options: ["Mohammed VI", "Safaa VI", "Messi", "Amine VI"],
      correct: "Safaa VI",
      ok: "‚úÖ Hadi hiya l7a9i9a li makay3rfohach nass üòåüëë",
      nope: "‚ùå La la‚Ä¶ lmalika hna üòå"
    },
    {
      text: "Ch7al katwahachni ?",
      options: ["Chwiya", "Bzaf", "Bzaf bzaf", "Hadi jarima 3alamia"],
      correct: "Hadi jarima 3alamia",
      ok: "‚úÖ Safi‚Ä¶ tribunal dyal l7ob valida üòå‚ù§Ô∏è",
      nope: "‚ùå Ma t9ssrsh‚Ä¶ 7awl tkon skhi asahbi üò≠"
    },
    {
      text: "Shkun hiya l7ob dyal 7yatk ?",
      options: ["Safaa", "Safa", "safaaaaaaaaaaaaa"],
      correct: "safaaaaaaaaaaaaa",
      ok: "‚úÖ Voil√†√†√†‚Ä¶ daba n9edro nkemlo üòå‚ù§Ô∏è",
      nope: "‚ùå Zid f les lettres‚Ä¶ mazal üòå"
    }
  ];

  // ========= DOM =========
  const scoreEl = document.getElementById("score");
  const maxScoreEl = document.getElementById("maxScore");
  const qIndexEl = document.getElementById("qIndex");
  const qTotalEl = document.getElementById("qTotal");
  const barEl = document.getElementById("bar");
  const questionTextEl = document.getElementById("questionText");
  const optionsEl = document.getElementById("options");
  const msgEl = document.getElementById("msg");
  const validateBtn = document.getElementById("validateBtn");
  const nextBtn = document.getElementById("nextBtn");
  const restartBtn = document.getElementById("restartBtn");
  const restartBtn2 = document.getElementById("restartBtn2");

  const quizCard = document.getElementById("quizCard");
  const finalCard = document.getElementById("finalCard");
  const finalText = document.getElementById("finalText");

  const startOverlay = document.getElementById("startOverlay");
  const startBtn = document.getElementById("startBtn");

  // ========= STATE =========
  let current = 0;
  let selected = null;
  let score = 0;
  let lockedCorrect = false;

  maxScoreEl.textContent = QUESTIONS.length;
  qTotalEl.textContent = QUESTIONS.length;

  // ========= Tiny sounds (WebAudio) =========
  let audioCtx = null;
  function beep(freq=700, duration=0.08, type="sine", gain=0.05){
    try{
      if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.type = type;
      o.frequency.value = freq;
      g.gain.value = gain;
      o.connect(g);
      g.connect(audioCtx.destination);
      o.start();
      o.stop(audioCtx.currentTime + duration);
    }catch(e){
      // If blocked, ignore.
    }
  }
  function successSound(){
    beep(660, 0.07, "triangle", 0.06);
    setTimeout(()=>beep(880, 0.09, "triangle", 0.06), 80);
  }
  function errorSound(){
    beep(220, 0.10, "sawtooth", 0.04);
  }

  // ========= Confetti =========
  const confettiCanvas = document.getElementById("confetti");
  const ctx = confettiCanvas.getContext("2d");
  let confetti = [];
  let confettiRAF = null;

  function resizeCanvas(){
    confettiCanvas.width = window.innerWidth * devicePixelRatio;
    confettiCanvas.height = window.innerHeight * devicePixelRatio;
  }
  window.addEventListener("resize", resizeCanvas);
  resizeCanvas();

  function spawnConfetti(count=80){
    const w = confettiCanvas.width;
    const h = confettiCanvas.height;
    for(let i=0;i<count;i++){
      confetti.push({
        x: Math.random() * w,
        y: -20 * devicePixelRatio,
        vx: (Math.random() - 0.5) * 2.8 * devicePixelRatio,
        vy: (Math.random() * 2.5 + 3.0) * devicePixelRatio,
        r: (Math.random() * 6 + 4) * devicePixelRatio,
        a: Math.random() * Math.PI * 2,
        va: (Math.random() - 0.5) * 0.2,
        life: Math.random() * 80 + 80
      });
    }
    if(!confettiRAF) animateConfetti();
  }

  function animateConfetti(){
    confettiRAF = requestAnimationFrame(animateConfetti);
    ctx.clearRect(0,0,confettiCanvas.width, confettiCanvas.height);

    confetti.forEach(p=>{
      p.x += p.vx;
      p.y += p.vy;
      p.a += p.va;
      p.vy *= 0.995;
      p.life -= 1;

      ctx.save();
      ctx.translate(p.x, p.y);
      ctx.rotate(p.a);
      ctx.globalAlpha = Math.max(0, Math.min(1, p.life/160));
      ctx.fillStyle = `hsl(${(p.x/8)%360}, 90%, 65%)`;
      ctx.fillRect(-p.r/2, -p.r/2, p.r, p.r*0.6);
      ctx.restore();
    });

    confetti = confetti.filter(p => p.life > 0 && p.y < confettiCanvas.height + 50*devicePixelRatio);
    if(confetti.length === 0){
      cancelAnimationFrame(confettiRAF);
      confettiRAF = null;
    }
  }

  // ========= UI helpers =========
  function resetUIForQuestion(){
    msgEl.style.display = "none";
    msgEl.className = "msg";
    validateBtn.disabled = true;
    nextBtn.style.display = "none";
    restartBtn.style.display = "none";
    selected = null;
    lockedCorrect = false;
  }

  function render(){
    const q = QUESTIONS[current];
    qIndexEl.textContent = (current + 1);
    const pct = Math.round((current) / QUESTIONS.length * 100);
    barEl.style.width = pct + "%";

    questionTextEl.textContent = q.text;
    optionsEl.innerHTML = "";

    q.options.forEach(opt => {
      const btn = document.createElement("div");
      btn.className = "opt";
      btn.setAttribute("role","button");
      btn.setAttribute("tabindex","0");
      btn.innerHTML = `
        <div class="radio"></div>
        <div><div style="font-weight:600">${opt}</div></div>
      `;

      const choose = () => {
        if (lockedCorrect) return;
        document.querySelectorAll(".opt").forEach(x => x.classList.remove("selected"));
        btn.classList.add("selected");
        selected = opt;
        validateBtn.disabled = false;
        beep(520, 0.04, "sine", 0.03);
      };

      btn.addEventListener("click", choose);
      btn.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " ") choose();
      });

      optionsEl.appendChild(btn);
    });

    resetUIForQuestion();
  }

  function showMsg(type, text){
    msgEl.style.display = "block";
    msgEl.className = "msg " + type;
    msgEl.textContent = text;
  }

  validateBtn.addEventListener("click", () => {
    const q = QUESTIONS[current];
    if (!selected) return;

    if (selected === q.correct){
      if (!lockedCorrect){
        score += 1;
        scoreEl.textContent = score;
      }
      lockedCorrect = true;

      successSound();
      spawnConfetti(70);

      showMsg("ok", q.ok || "‚úÖ Correct !");
      nextBtn.style.display = "inline-block";

      const pct = Math.round(((current + 1) / QUESTIONS.length) * 100);
      barEl.style.width = pct + "%";

      validateBtn.disabled = true;
    } else {
      errorSound();
      showMsg("error", q.nope || "‚ùå Non‚Ä¶ essaie encore.");
      nextBtn.style.display = "none";

      if (HARD_MODE_RESTART_ON_WRONG){
        setTimeout(() => {
          restart();
          showMsg("error", "üòà HARD MODE: ghlti‚Ä¶ ÿ±ÿ¨ÿπÿ™Ÿä ŸÖŸÜ ÿßŸÑŸÑŸàŸÑ!");
        }, 450);
      }
    }
  });

  nextBtn.addEventListener("click", () => {
    current += 1;
    if (current >= QUESTIONS.length){
      finish();
      return;
    }
    render();
  });

  function finish(){
    quizCard.style.display = "none";
    finalCard.style.display = "block";
    successSound();
    spawnConfetti(220);

    finalText.innerHTML = `
      Score dyalk : <b>${score}/${QUESTIONS.length}</b> ü•≥<br><br>
      <b>Joyeux anniversaire mon amour üéÇ‚ù§Ô∏è</b><br>
      Kanmtanna lik 3am kbir b lkhir, lfar7a w r√©ussite‚Ä¶<br>
      <span style="color:var(--accent2)"><b>ŸÉŸÜÿ®ÿ∫ŸäŸÉ safaaaaaaaaaaaaa fois</b></span> ‚ú®
    `;
  }

  function restart(){
    current = 0;
    score = 0;
    selected = null;
    lockedCorrect = false;
    scoreEl.textContent = "0";
    quizCard.style.display = "block";
    finalCard.style.display = "none";
    barEl.style.width = "0%";
    render();
  }

  restartBtn.addEventListener("click", restart);
  restartBtn2.addEventListener("click", restart);

  // Start overlay
  startBtn.addEventListener("click", () => {
    // create audio context on user gesture
    beep(620, 0.06, "triangle", 0.05);
    startOverlay.style.display = "none";
    render();
  });

  // init (wait for start)
  barEl.style.width = "0%";
</script>
</body>
</html>
